import pandas as pd

# Updated Excel path with your filename
input_path = r"C:\Users\admins\Desktop\Isro BAH\AL1_ASW91_L2_TH2_20250701_UNP_9999_999999_V02 (1).xlsx"
output_path = input_path.replace(".xlsx", "_CLEANED.xlsx")

# Read entire Excel file
xls = pd.ExcelFile(input_path)
writer = pd.ExcelWriter(output_path, engine='openpyxl')

# Process each sheet
for sheet in xls.sheet_names:
    df = pd.read_excel(xls, sheet_name=sheet)
    print(f"\n--- Processing: {sheet} ---")

    # Sector-wise flux cleaning
    if "integrated_flux_s" in sheet:
        df_filled = df.fillna(method='ffill').fillna(method='bfill').rolling(window=5, min_periods=1).mean()
        print("✅ Sector flux filled with rolling mean")

    # Total Flux
    elif "integrated_flux_mod" in sheet:
        df_filled = df.fillna(method='ffill').fillna(method='bfill').rolling(window=5, min_periods=1).mean()
        print("✅ Total flux filled with rolling mean")

    # Energy Center
    elif "energy_center_mod" in sheet:
        df_filled = df.fillna(method='ffill').fillna(method='bfill')
        print("✅ Energy center forward-filled")

    # Spacecraft positions
    elif "spacecraft_" in sheet:
        df_filled = df.interpolate(method='linear', limit_direction='both')
        print("✅ Spacecraft position linearly interpolated")

    # Sun angle
    elif "sun_angle_tha2" in sheet:
        df_filled = df.interpolate(method='linear', limit_direction='both')
        print("✅ Sun angle interpolated")

    # Other sheets: ffill + bfill fallback
    else:
        df_filled = df.fillna(method='ffill').fillna(method='bfill')
        print("⚠️ Other sheet filled with ffill/bfill")

    # Save cleaned sheet
    df_filled.to_excel(writer, sheet_name=sheet[:31], index=False)

writer.close()
print(f"\n✅ Cleaned file saved at:\n{output_path}")
